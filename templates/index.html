<!doctype html>
<html lang="en">
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <head>
        {% block head %}
    <style>
        .button1 {
        background-image: url("{{url_for('static', filename='Accept-icon.png')}}");
            background-size: cover;
            width: 20px;
            height: 20px;
            font-size: 2rem;
        }     
    </style>
    
        <style type="text/css">
            .tg  {border-collapse:collapse;border-spacing:0;}
            .tg td{border-color:black;border-style:solid;border-width:0px;}
            .tg .tg-date{text-align:center;vertical-align:center}
            .tg .tg-object{border-spacing:20px;}
            .tg .tg-fine{border-color:black;border-style:solid;border-width:1px;background-color:black}
            .tg .tg-value{text-align:center;vertical-align:center}
            .tg .tg-name{text-align:center;vertical-align:center}
            tr:nth-child(odd) {
                background-color: #D6EEEE;
            }
        </style>

    <link href="//code.jquery.com/ui/1.10.2/themes/smoothness/jquery-ui.css" rel="Stylesheet"></link>
    <script src="//code.jquery.com/jquery-2.2.0.min.js"></script>
    <script src="//code.jquery.com/ui/1.10.2/jquery-ui.js" ></script>
    
    <script type="text/javascript">
        var my_database = [
        {% for item in presenze %}
            {
                id: "{{item.id}}",
                name: "{{item.name}}",
                pranzo: "{{item.pranzo}}", 
                cena: "{{item.cena}}", 
                dormire: "{{item.dormire}}", 
                pranzoDef: "{{item.pranzoDefault}}", 
                cenaDef: "{{item.cenaDefault}}", 
                dormireDef: "{{item.dormireDefault}}", 
            },
        {% endfor %}
        ];
        
        $(document).ready(function() {
            reload();
        });
        
        function reload() {
          var pranzi = 0;
          var nomiPranzi = [];
          var cene = 0;
          var nomiCena = [];
          var dormire = 0;
          var nomiDormire = [];
          const d = new Date();
          var weekOfDay = [6,0,1,2,3,4,5];
          var giornoDellaSettimana = 1 << weekOfDay[d.getDay()];
          var date = new Date();
            
          {% for item in presenze %}
            if ({{item.pranzo}} & giornoDellaSettimana != 0) {
              pranzi++;
              nomiPranzi += " {{item.name}} ";
            }
            else
            {
              document.getElementById('pranzo0_{{item.id}}').style.backgroundColor  = "red";
              document.getElementById('pranzo0_{{item.id}}').style.color = "white";
            }
                    
            if ({{item.cena}} & giornoDellaSettimana != 0) {
              cene++;
              nomiCena += " {{item.name}} ";
            }

            if ({{item.dormire}} & giornoDellaSettimana != 0) {
              dormire++;
              nomiDormire += " {{item.name}} ";
            }
            
            var color;
            var dayofweek;
            for (let i = 0; i < 7; i++) {
                date.setDate(date.getDate() + i);
                dayofweek = 1 << weekOfDay[date.getDay()];
                color  = "red";
                if ({{item.pranzo}} & dayofweek != 0) {
                    color = "green";
                }

                document.getElementById("pranzo" + i + "_{{item.id}}").style.backgroundColor  = color;
                document.getElementById("pranzo" + i + "_{{item.id}}").style.color = "white";

                color  = "red";
                if ({{item.cena}} & dayofweek != 0) {
                    color  = "green";
                }

                document.getElementById("cena" + i + "_{{item.id}}").style.backgroundColor = color;
                document.getElementById("cena" + i + "_{{item.id}}").style.color = "white";

                color  = "red";
                if ({{item.dormire}} & dayofweek != 0) {
                    color  = "green";
                }

                document.getElementById("dormire" + i + "_{{item.id}}").style.backgroundColor  = color;
                document.getElementById("dormire" + i + "_{{item.id}}").style.color = "white";
            }
          {% endfor %}
          

          document.getElementById('pranzoAll').innerHTML = "Pranzo (" + pranzi + "): " + nomiPranzi;
          document.getElementById('cenaAll').innerHTML = "Cena (" + cene + "): " + nomiCena;
          document.getElementById('dormireAll').innerHTML = "Dormire (" + dormire + "): " + nomiDormire;

          document.getElementById('today0').innerHTML = d.addDays(0);
          document.getElementById('today1').innerHTML = d.addDays(1);
          document.getElementById('today2').innerHTML = d.addDays(2);
          document.getElementById('today3').innerHTML = d.addDays(3);
          document.getElementById('today4').innerHTML = d.addDays(4);
          document.getElementById('today5').innerHTML = d.addDays(5);
          document.getElementById('today6').innerHTML = d.addDays(6);
        }
        
        Date.prototype.addDays = function(days) {
            //var dayName = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            var dayName = ['Dom', 'Lun', 'Mar', 'Mer', 'Gio', 'Ven', 'Sab'];
            var date = new Date();
            date.setDate(date.getDate() + days);
            return (("0" + date.getDate()).slice(-2) + "<br>" + dayName[date.getDay()]);
        }
        
        function update(id) {
            console.log(id);
        }
    </script>
    {% endblock %}
    </head>
    <title>PresenzaApp</title>
    <body>
    <nav class="navbar navbar-dark bg-dark">
        <div class="container-fluid">
        <a id="num_elements" class="navbar-brand" href="#">
            PresenzaApp - v 1.0
        </a>
        </div>
    </nav>
        <div id="pranzoAll"></div>
        <div id="cenaAll"></div>
        <div id="dormireAll"></div>
        <table class="tg" width="100%">
            <tbody>
              <tr>
                <th class="tg-date"></th>
                <th class="tg-date" id="today0"></th>
                <th class="tg-date" id="today1"></th>
                <th class="tg-date" id="today2"></th>
                <th class="tg-date" id="today3"></th>
                <th class="tg-date" id="today4"></th>
                <th class="tg-date" id="today5"></th>
                <th class="tg-date" id="today6"></th>
              </tr>
    {% for product in presenze %}
      <tr>
        <td class="tg-name" rowspan="6">{{product.name}}</td>
        <td class="tg-object" colspan="7"></td>
      </tr>
      <tr>
        <td class="tg-value"><button id="pranzo0_{{product.id}}" onclick="update('pranzo0_{{product.id}}')">P</button></td>
        <td class="tg-value"><button id="pranzo1_{{product.id}}">P</button></td>
        <td class="tg-value"><button id="pranzo2_{{product.id}}">P</button></td>
        <td class="tg-value"><button id="pranzo3_{{product.id}}">P</button></td>
        <td class="tg-value"><button id="pranzo4_{{product.id}}">P</button></td>
        <td class="tg-value"><button id="pranzo5_{{product.id}}">P</button></td>
        <td class="tg-value"><button id="pranzo6_{{product.id}}">P</button></td>
    </tr>
    <tr>
        <td class="tg-object" colspan="7"></td>
    </tr>
    <tr>
        <td class="tg-value"><button id="cena0_{{product.id}}">C</button></td>
        <td class="tg-value"><button id="cena1_{{product.id}}">C</button></td>
        <td class="tg-value"><button id="cena2_{{product.id}}">C</button></td>
        <td class="tg-value"><button id="cena3_{{product.id}}">C</button></td>
        <td class="tg-value"><button id="cena4_{{product.id}}">C</button></td>
        <td class="tg-value"><button id="cena5_{{product.id}}">C</button></td>
        <td class="tg-value"><button id="cena6_{{product.id}}">C</button></td>
    </tr>
    <tr>
        <td class="tg-object" colspan="7"></td>
    </tr>
    <tr>
        <td class="tg-value"><button id="dormire0_{{product.id}}">D</button></td>
        <td class="tg-value"><button id="dormire1_{{product.id}}">D</button></td>
        <td class="tg-value"><button id="dormire2_{{product.id}}">D</button></td>
        <td class="tg-value"><button id="dormire3_{{product.id}}">D</button></td>
        <td class="tg-value"><button id="dormire4_{{product.id}}">D</button></td>
        <td class="tg-value"><button id="dormire5_{{product.id}}">D</button></td>
        <td class="tg-value"><button id="dormire6_{{product.id}}">D</button></td>
    </tr>
    <tr>
        <td class="tg-fine" colspan="8"></td>
    </tr>
    {% endfor %}
            </tbody>
            </table>
    
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    </body>
</html>
